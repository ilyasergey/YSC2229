

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.3. Stacks &mdash; YSC2229 2021</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6.4. Queues" href="week-06-queues.html" />
    <link rel="prev" title="6.2. Information Hiding and Abstraction" href="week-06-abstract-data-types.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> YSC2229: Introductory Data Structures and Algorithms
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="syllabus.html">1. Course Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">2. Software Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="codestyle.html">3. OCaml Style Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="week-01.html">1. Week 01: Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-02.html">2. Week 02: Working with Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-03.html">3. Week 03: Complexity of Algorithms and Order Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-04.html">4. Week 04: Divide-and-Conquer Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-05.html">5. Week 05: Binary Heaps and Priority Queues</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="week-06.html">6. Week 06: Abstract Data Types</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="week-09-union-find.html">6.1. Equivalence Classes and Union-Find</a></li>
<li class="toctree-l2"><a class="reference internal" href="week-06-abstract-data-types.html">6.2. Information Hiding and Abstraction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.3. Stacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-stack-interface">6.3.1. The Stack interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#an-list-based-stack">6.3.2. An List-Based Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#an-array-based-stack">6.3.3. An Array-Based Stack</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="week-06-queues.html">6.4. Queues</a></li>
<li class="toctree-l2"><a class="reference internal" href="week-06-exercises.html">6.5. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="midterm.html">7. Midterm Project: Memory Allocation and Reclamation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-07.html">8. Week 07: Hashing-Based Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-08.html">9. Week 08: Searching in Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-09.html">10. Week 09: Backtracking and Dynamic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-10.html">11. Week 10: Binary Data Compression</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">YSC2229: Introductory Data Structures and Algorithms</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="week-06.html">6. Week 06: Abstract Data Types</a> &raquo;</li>
        
      <li>6.3. Stacks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stacks">
<h1>6.3. Stacks<a class="headerlink" href="#stacks" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>File: <code class="docutils literal notranslate"><span class="pre">Stacks.ml</span></code></li>
</ul>
<p>Stack is a good example of a simple abstract data type that implements
a set (with possibly repeating elements) with a small number of
operations for adding and removing elements. In doing so, stack
provides two main operations <code class="docutils literal notranslate"><span class="pre">pop</span></code> and <code class="docutils literal notranslate"><span class="pre">push</span></code> that implement a
discipline known as LIFO (last-in-first-out): an element added last is
retrieved first.</p>
<div class="section" id="the-stack-interface">
<h2>6.3.1. The Stack interface<a class="headerlink" href="#the-stack-interface" title="Permalink to this headline">¶</a></h2>
<p>A simple stack interface is described by the following OCaml module signature:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">AbstractStack</span> <span class="o">=</span> <span class="k">sig</span>
    <span class="k">type</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">mk_stack</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span>
    <span class="k">val</span> <span class="n">is_empty</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
    <span class="k">val</span> <span class="n">push</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="kt">unit</span>
    <span class="k">val</span> <span class="n">pop</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">option</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>Notice that the first type member (<code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">'e</span> <span class="pre">t</span></code>) is what makes this data type
abstract. The type declaration stands for and “abstract type <code class="docutils literal notranslate"><span class="pre">t</span></code> of the stack
storing elements of type <code class="docutils literal notranslate"><span class="pre">'e</span></code>”. In reality, the stack, as a data structure,
can be implemented in various ways, but this type definition does not reveal
those details. Instead, it provides four functions to manipulate with stacks —
and this is the only vocabulary for doing so. Specifically:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">mk_stack</span></code> creates a new empty stack (hence the output result is
<code class="docutils literal notranslate"><span class="pre">'e</span> <span class="pre">t</span></code>) with a suggested size <code class="docutils literal notranslate"><span class="pre">n</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">is_empty</span></code> checks is the stack is empty</li>
<li><code class="docutils literal notranslate"><span class="pre">push</span></code> adds new element to the top of the stack</li>
<li><code class="docutils literal notranslate"><span class="pre">pop</span></code> removes the latest added element <code class="docutils literal notranslate"><span class="pre">e</span></code> from the top of the
stack and returns <code class="docutils literal notranslate"><span class="pre">Some</span> <span class="pre">e</span></code>, if such element exists, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
the stack is empty. The stack is then modified, so this element is
removed.</li>
</ul>
<p>Unlike OCaml list, is a <em>mutable</em> structure. This means each
“effectful” operation of it, such as <code class="docutils literal notranslate"><span class="pre">push</span></code> or <code class="docutils literal notranslate"><span class="pre">pop</span></code>, changes its
contents, rather than returns a new copy, the result type of <code class="docutils literal notranslate"><span class="pre">push</span></code>
is <code class="docutils literal notranslate"><span class="pre">unit</span></code>. Both <code class="docutils literal notranslate"><span class="pre">push</span></code> and <code class="docutils literal notranslate"><span class="pre">pop</span></code>, thus, modify the stack
contents, in addition to returning a result (in the case of <code class="docutils literal notranslate"><span class="pre">pop</span></code>).</p>
</div>
<div class="section" id="an-list-based-stack">
<h2>6.3.2. An List-Based Stack<a class="headerlink" href="#an-list-based-stack" title="Permalink to this headline">¶</a></h2>
<p>Our first concrete implementation of a stack ADT exploits the fact
that OCaml lists behave precisely like stacks, so we can build the
following implementation almost effortlessly:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ListBasedStack</span> <span class="o">:</span> <span class="nc">AbstractStack</span> <span class="o">=</span> <span class="k">struct</span>
    <span class="k">type</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span> <span class="o">=</span> <span class="k">&#39;</span><span class="n">e</span> <span class="kt">list</span> <span class="n">ref</span>
    <span class="k">let</span> <span class="n">mk_stack</span> <span class="o">_</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span>
    <span class="k">let</span> <span class="n">is_empty</span> <span class="n">s</span> <span class="o">=</span> <span class="k">match</span> <span class="o">!</span><span class="n">s</span> <span class="k">with</span>
      <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">true</span>
      <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">false</span>
    <span class="k">let</span> <span class="n">push</span> <span class="n">s</span> <span class="n">e</span> <span class="o">=</span>
      <span class="k">let</span> <span class="n">c</span> <span class="o">=</span> <span class="o">!</span><span class="n">s</span> <span class="k">in</span>
      <span class="n">s</span> <span class="o">:=</span> <span class="n">e</span> <span class="o">::</span> <span class="n">c</span>
    <span class="k">let</span> <span class="n">pop</span> <span class="n">s</span> <span class="o">=</span> <span class="k">match</span> <span class="o">!</span><span class="n">s</span> <span class="k">with</span>
      <span class="o">|</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="o">-&gt;</span>
        <span class="n">s</span> <span class="o">:=</span> <span class="n">t</span><span class="o">;</span> <span class="nc">Some</span> <span class="n">h</span>
      <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>What is important to notice is that <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">'e</span> <span class="pre">t</span></code> in the concrete implementation
is defined to be <code class="docutils literal notranslate"><span class="pre">'e</span> <span class="pre">list</span> <span class="pre">ref</span></code>, so in the rest of the module we can use the
properties of this concrete data type (i.e., dereference it and work with it as
with an OCaml list). Notice also that the concrete module <code class="docutils literal notranslate"><span class="pre">ListBasedStack</span></code> is
annotated with the abstract signature <code class="docutils literal notranslate"><span class="pre">AbstractStack</span></code>, making sure that all
definitions have the matching types. The implication of this is that <cite>no user</cite>
of this module will be able to exploit the fact that our “stack type” is, in
fact, a reference to an OCaml list. An example of such an “exploit” would be,
for instance, making the stack empty foregoing the use of <code class="docutils literal notranslate"><span class="pre">pop</span></code> in order to
deplete it first, element by element.</p>
<p>When implementing your own concrete implementation of an abstract data type, it
is recommended to ascribe the module signature (e.g., <code class="docutils literal notranslate"><span class="pre">AbstractStack</span></code>) as the
<cite>last</cite> step of your implementation. If you do it before the module is complete,
the OCaml compiler/back-end will be complaining that your implementation of the
module does not match the signature, which makes the whole development process
less pleasant.</p>
<p>Let us now test our stack ADT implementation by pushing and popping
different elements, keeping in mind the expected LIFO behaviour. We
start by reating an empty stack:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">ListBasedStack</span><span class="p">.</span><span class="n">mk_stack</span> <span class="bp">()</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">s</span> <span class="o">:</span> <span class="k">&#39;</span><span class="o">_</span><span class="n">weak101</span> <span class="nn">ListBasedStack</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Notice that the type <code class="docutils literal notranslate"><span class="pre">'_weak101</span></code> indicates that OCaml doesn’t yet
know what is the type of stack elements, and it will be clear once we
push the first one. Furthermore the type of the stack itself is
presented as <code class="docutils literal notranslate"><span class="pre">ListBasedStack.t</span></code>, i.e., it is not shown to be a
reference to list – what we defined it to be. Let us now push three
elements to a stack and check it for emptiness:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">push</span> <span class="n">s</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s2">&quot;aaa&quot;</span><span class="o">);;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
<span class="o">#</span> <span class="n">push</span> <span class="n">s</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s2">&quot;bbb&quot;</span><span class="o">);;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
<span class="o">#</span> <span class="n">push</span> <span class="n">s</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="s2">&quot;ccc&quot;</span><span class="o">);;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
<span class="o">#</span> <span class="n">is_empty</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">false</span>
</pre></div>
</div>
<p>As the next step, we can start removing elements from the stack, making sure that they come up in the reverse order with respect to how they were added:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="s2">&quot;ccc&quot;</span><span class="o">)</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s2">&quot;bbb&quot;</span><span class="o">)</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s2">&quot;aaa&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Finally, we can test that, after we’ve removed all initially added
elements, the stack is empty and remains this way:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">None</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="an-array-based-stack">
<h2>6.3.3. An Array-Based Stack<a class="headerlink" href="#an-array-based-stack" title="Permalink to this headline">¶</a></h2>
<p>An alternative implementation of stacks uses an array of some size
<code class="docutils literal notranslate"><span class="pre">n</span></code>, thus requiring constant-size memory. A natural shortcoming of
such a solution is the fact that the stack can hold only up to <code class="docutils literal notranslate"><span class="pre">n</span></code>
elements. However, the advantage is that one can implement such a
stack in language that do not provide algebraic lists, but only
provide arrays (e.g., C):</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">ArrayBasedStack</span> <span class="o">:</span> <span class="nc">AbstractStack</span> <span class="o">=</span> <span class="k">struct</span>
    <span class="k">type</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">t</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">elems</span>   <span class="o">:</span> <span class="k">&#39;</span><span class="n">e</span> <span class="n">option</span> <span class="kt">array</span><span class="o">;</span>
      <span class="n">cur_pos</span> <span class="o">:</span> <span class="kt">int</span> <span class="n">ref</span>
    <span class="o">}</span>

    <span class="c">(* More functions to be added here *)</span>
  <span class="k">end</span>
</pre></div>
</div>
<p>The abstract type <code class="docutils literal notranslate"><span class="pre">'e</span> <span class="pre">t</span></code> is now defined quite differently — it is
a record that stores two fields. The first one is an array of options
of elements of type <code class="docutils literal notranslate"><span class="pre">'e</span></code> (representing the elements of the stack in
a desired order), while the second one is a pointer to the position
<code class="docutils literal notranslate"><span class="pre">cur_pos</span></code> at which the next element of the stack must be added.
Defining the stack this way, we agree on the following invariant: the
“empty” elements in a stack are represented by <code class="docutils literal notranslate"><span class="pre">None</span></code>, which the
array, serving as a “carrier” for the stack will be filled with
elements from its beginning, with <code class="docutils literal notranslate"><span class="pre">cur_pos</span></code> pointing to the next
empty position to fill. For instance, a stack with the maximal
capacity of 3 elements, with the elements <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;b&quot;</span></code> will be
represented by the array <code class="docutils literal notranslate"><span class="pre">[|Some</span> <span class="pre">&quot;b&quot;;</span> <span class="pre">Some</span> <span class="pre">&quot;a&quot;;</span> <span class="pre">None|]</span></code>, with
<code class="docutils literal notranslate"><span class="pre">cur_pos</span></code> being <code class="docutils literal notranslate"><span class="pre">2</span></code>, indicating the next slot to insert an
element.</p>
<p>In order to make a new stack, we create a fixed-length array for size
<code class="docutils literal notranslate"><span class="pre">n</span></code>, setting <code class="docutils literal notranslate"><span class="pre">cur_ref</span></code> to point to 0:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">mk_stack</span> <span class="n">n</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">elems</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="n">n</span> <span class="nc">None</span><span class="o">;</span>
  <span class="n">cur_pos</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span>
<span class="o">}</span>
</pre></div>
</div>
<p>We can also use <code class="docutils literal notranslate"><span class="pre">cur_pos</span></code> to determine whether the stack is empty or
not:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">is_empty</span> <span class="n">s</span> <span class="o">=</span> <span class="o">!(</span><span class="n">s</span><span class="o">.</span><span class="n">cur_pos</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Pushing a new element requires us to insert a new element into the
next vacant position in the “carrier” array and then increment the
current position. If the current position points outside of the scope
of the array, it means that the stack is full and cannot accommodate
more elements, so we just throw an exception:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">push</span> <span class="n">s</span> <span class="n">e</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="o">!(</span><span class="n">s</span><span class="o">.</span><span class="n">cur_pos</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span><span class="o">.</span><span class="n">elems</span>
  <span class="k">then</span> <span class="k">raise</span> <span class="o">(</span><span class="nc">Failure</span> <span class="s2">&quot;Stack is full&quot;</span><span class="o">)</span>
  <span class="k">else</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">elems</span><span class="o">.(</span><span class="n">pos</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="nc">Some</span> <span class="n">e</span><span class="o">;</span>
        <span class="n">s</span><span class="o">.</span><span class="n">cur_pos</span> <span class="o">:=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
<p>Similarly, <code class="docutils literal notranslate"><span class="pre">pop</span></code> returns an element (wrapped into <code class="docutils literal notranslate"><span class="pre">Some</span></code>) right
before <code class="docutils literal notranslate"><span class="pre">cur_pos</span></code>, if <code class="docutils literal notranslate"><span class="pre">cur_pos</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code> otherwise:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">pop</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="o">!(</span><span class="n">s</span><span class="o">.</span><span class="n">cur_pos</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">elems</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">elems</span> <span class="k">in</span>
  <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="nc">None</span>
  <span class="k">else</span> <span class="o">(</span>
    <span class="k">let</span> <span class="n">res</span> <span class="o">=</span> <span class="n">elems</span><span class="o">.(</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
    <span class="n">s</span><span class="o">.</span><span class="n">elems</span><span class="o">.(</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="nc">None</span><span class="o">;</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cur_pos</span> <span class="o">:=</span> <span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
    <span class="n">res</span><span class="o">)</span>
</pre></div>
</div>
<p>Let us test the implementation to make sure that it indeed behaves as
a stack:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="k">open</span> <span class="nc">ArrayBasedStack</span><span class="o">;;</span>
<span class="o">#</span> <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">mk_stack</span> <span class="mi">10</span><span class="o">;;</span>
<span class="k">val</span> <span class="n">s</span> <span class="o">:</span> <span class="k">&#39;</span><span class="o">_</span><span class="n">weak102</span> <span class="nn">ArrayBasedStack</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="n">push</span> <span class="n">s</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s2">&quot;aaa&quot;</span><span class="o">);;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
<span class="o">#</span> <span class="n">push</span> <span class="n">s</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s2">&quot;bbb&quot;</span><span class="o">);;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
<span class="o">#</span> <span class="n">push</span> <span class="n">s</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="s2">&quot;ccc&quot;</span><span class="o">);;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">unit</span> <span class="o">=</span> <span class="bp">()</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="s2">&quot;ccc&quot;</span><span class="o">)</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s2">&quot;bbb&quot;</span><span class="o">)</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">Some</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s2">&quot;aaa&quot;</span><span class="o">)</span>
<span class="o">#</span> <span class="n">is_empty</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">bool</span> <span class="o">=</span> <span class="bp">true</span>
<span class="o">#</span> <span class="n">pop</span> <span class="n">s</span><span class="o">;;</span>
<span class="o">-</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">*</span> <span class="kt">string</span><span class="o">)</span> <span class="n">option</span> <span class="o">=</span> <span class="nc">None</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="week-06-queues.html" class="btn btn-neutral float-right" title="6.4. Queues" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="week-06-abstract-data-types.html" class="btn btn-neutral" title="6.2. Information Hiding and Abstraction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Ilya Sergey

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"]})</script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>