

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.5. Generalising Comparison-Based Sorting &mdash; YSC2229 2021</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4.6. Exercises" href="week-04-exercises.html" />
    <link rel="prev" title="4.4. Complexity of Divide-and-Conquer Algorithms" href="week-04-divide-and-conquer-complexity.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> YSC2229: Introductory Data Structures and Algorithms
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="syllabus.html">1. Course Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">2. Software Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="codestyle.html">3. OCaml Style Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="week-01.html">1. Week 01: Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-02.html">2. Week 02: Working with Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-03.html">3. Week 03: Complexity of Algorithms and Order Notation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="week-04.html">4. Week 04: Divide-and-Conquer Algorithms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="week-03-search.html">4.1. Searching in Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="week-03-merge-sort.html">4.2. Merge Sort</a></li>
<li class="toctree-l2"><a class="reference internal" href="week-04-quicksort.html">4.3. Quicksort and its Variations</a></li>
<li class="toctree-l2"><a class="reference internal" href="week-04-divide-and-conquer-complexity.html">4.4. Complexity of Divide-and-Conquer Algorithms</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.5. Generalising Comparison-Based Sorting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comparator-as-a-parameter">4.5.1. Comparator as a parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-functor-for-sorting">4.5.2. A functor for sorting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="week-04-exercises.html">4.6. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="week-05.html">5. Week 05: Binary Heaps and Priority Queues</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-06.html">6. Week 06: Abstract Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="midterm.html">7. Midterm Project: Memory Allocation and Reclamation</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-07.html">8. Week 07: Hashing-Based Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="week-08.html">9. Week 08: Searching in Strings</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">YSC2229: Introductory Data Structures and Algorithms</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="week-04.html">4. Week 04: Divide-and-Conquer Algorithms</a> &raquo;</li>
        
      <li>4.5. Generalising Comparison-Based Sorting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generalising-comparison-based-sorting">
<h1>4.5. Generalising Comparison-Based Sorting<a class="headerlink" href="#generalising-comparison-based-sorting" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>File: <code class="docutils literal notranslate"><span class="pre">GeneralisedSorting.ml</span></code></li>
</ul>
<p>So far we have seen a number of sorting algorithms that were useful on arrays of particular shape, such as filled with just integers, or pairs having integers as their first components. However, the only operation we required of a data inhabiting the array to provide is the ability to <em>compare</em> its elements with each other. Such an ability has been provided by means of comparing integers, but the very same algorithms can be used, e.g., for sorting arrays of lists (ordered via length) or strings (ordered lexicographically), or even arrays of arrays.</p>
<p>Let us generalise the latest introduced sorting algorithm, namely, Quicksort via two different mechanisms OCaml provides.</p>
<div class="section" id="comparator-as-a-parameter">
<h2>4.5.1. Comparator as a parameter<a class="headerlink" href="#comparator-as-a-parameter" title="Permalink to this headline">¶</a></h2>
<p>The following implementation of <code class="docutils literal notranslate"><span class="pre">generic_quick_sort</span></code> takes a <em>named</em> parameter <code class="docutils literal notranslate"><span class="pre">comp</span></code> (hence the syntax with <code class="docutils literal notranslate"><span class="pre">~</span></code>). It serves as a <em>comparator</em> — a function that takes an element of an array and returns an integer. The contract the implementation follows is that if <code class="docutils literal notranslate"><span class="pre">comp</span> <span class="pre">x</span> <span class="pre">y</span></code> returns a negative integer, it is interpreted as <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">y</span></code>, a positive integer means <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">y</span></code> and zero means <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">y</span></code>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">generic_quick_sort</span> <span class="n">arr</span> <span class="o">~</span><span class="n">comp</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">partition</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">hi</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">hi</span> <span class="o">&lt;=</span> <span class="n">lo</span> <span class="k">then</span> <span class="n">lo</span>
    <span class="k">else</span>
      <span class="k">let</span> <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.(</span><span class="n">hi</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ref</span> <span class="n">lo</span> <span class="k">in</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="n">lo</span> <span class="k">to</span> <span class="n">hi</span> <span class="o">-</span> <span class="mi">2</span> <span class="k">do</span>
        <span class="k">if</span> <span class="n">comp</span> <span class="n">arr</span><span class="o">.(</span><span class="n">j</span><span class="o">)</span> <span class="n">pivot</span> <span class="o">&lt;=</span> <span class="mi">0</span>
        <span class="k">then</span>
          <span class="o">(</span><span class="n">swap</span> <span class="n">arr</span> <span class="o">!</span><span class="n">i</span> <span class="n">j</span><span class="o">;</span>
           <span class="n">i</span> <span class="o">:=</span> <span class="o">!</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
      <span class="k">done</span><span class="o">;</span>
      <span class="n">swap</span> <span class="n">arr</span> <span class="o">!</span><span class="n">i</span> <span class="o">(</span><span class="n">hi</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">!</span><span class="n">i</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">sort</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">hi</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">then</span> <span class="bp">()</span>
    <span class="k">else</span>
      <span class="k">let</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">partition</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">hi</span> <span class="k">in</span>
      <span class="n">sort</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">mid</span><span class="o">;</span>
      <span class="n">sort</span> <span class="n">arr</span> <span class="n">mid</span> <span class="n">hi</span>
  <span class="k">in</span>
  <span class="n">sort</span> <span class="n">arr</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span><span class="o">)</span>
</pre></div>
</div>
<p>Notice that nothing else is known about the elements of an array, only the fact that they can be passed to <code class="docutils literal notranslate"><span class="pre">comp</span></code> getting an integer in return.</p>
<p>We can now instantiate <code class="docutils literal notranslate"><span class="pre">generic_quick_sort</span></code> with different comparators, sorting arrays of arbitrary elements, which we know how to compare, in an ascending or a descending order. For instance, the following comparator restores the familiar logic of sorting an array of integers:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">int_order_asc</span> <span class="o">=</span>
  <span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="k">if</span>
    <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="k">then</span> <span class="mi">0</span>
    <span class="k">else</span> <span class="mi">1</span>
</pre></div>
</div>
<p>We can test it with success:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="o">%</span><span class="n">test</span> <span class="o">_</span> <span class="o">=</span>
  <span class="n">random_sorting_test_int</span>
    <span class="o">(</span><span class="n">generic_quick_sort</span> <span class="o">~</span><span class="n">comp</span><span class="o">:</span><span class="n">int_order_asc</span><span class="o">)</span> <span class="mi">500</span>
</pre></div>
</div>
</div>
<div class="section" id="a-functor-for-sorting">
<span id="sec-functor-sorting"></span><h2>4.5.2. A functor for sorting<a class="headerlink" href="#a-functor-for-sorting" title="Permalink to this headline">¶</a></h2>
<p>Another way to define generic sorting is by using OCaml’s mechanisms of <em>modules</em> as a way to bundle several dependent definitions together, and <em>functors</em> — modules that take other modules as parameters.</p>
<p>The following code defines a <em>module signature</em> — an abstract interface that postulates that the modules satisfying this signature will feature a concrete type <code class="docutils literal notranslate"><span class="pre">t</span></code> and a function <code class="docutils literal notranslate"><span class="pre">comp</span></code> of type <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">-&gt;</span> <span class="pre">t</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="k">type</span> <span class="nc">Comparable</span> <span class="o">=</span> <span class="k">sig</span>
  <span class="k">type</span> <span class="n">t</span>
  <span class="k">val</span> <span class="n">comp</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">int</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Intuitively, you can think of the module signature <code class="docutils literal notranslate"><span class="pre">Comparable</span></code> as of a “promise” to give a data type <code class="docutils literal notranslate"><span class="pre">t</span></code>, whose elements we will know how to compare via <code class="docutils literal notranslate"><span class="pre">comp</span></code> that comes “bundled” with it.</p>
<p>Without even having specific instances of this signature, we can go ahead and describe a higher-order module (functor) <code class="docutils literal notranslate"><span class="pre">Sorting</span></code>, which, if given an instance <code class="docutils literal notranslate"><span class="pre">Comp</span></code> of a signature <code class="docutils literal notranslate"><span class="pre">Comparable</span></code>, will provide a function to sort arrays, whose elements are of type <code class="docutils literal notranslate"><span class="pre">Comp.t</span></code>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">Sorting</span> <span class="o">(</span><span class="nc">Comp</span><span class="o">:</span> <span class="nc">Comparable</span><span class="o">)</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">include</span> <span class="nc">Comp</span>

  <span class="k">let</span> <span class="n">sort</span> <span class="n">arr</span>  <span class="o">=</span>
    <span class="k">let</span> <span class="n">partition</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">hi</span> <span class="o">=</span>
      <span class="k">if</span> <span class="n">hi</span> <span class="o">&lt;=</span> <span class="n">lo</span> <span class="k">then</span> <span class="n">lo</span>
      <span class="k">else</span>
        <span class="k">let</span> <span class="n">pivot</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.(</span><span class="n">hi</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ref</span> <span class="n">lo</span> <span class="k">in</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="n">lo</span> <span class="k">to</span> <span class="n">hi</span> <span class="o">-</span> <span class="mi">2</span> <span class="k">do</span>
          <span class="k">if</span> <span class="n">comp</span> <span class="n">arr</span><span class="o">.(</span><span class="n">j</span><span class="o">)</span> <span class="n">pivot</span> <span class="o">&lt;=</span> <span class="mi">0</span>
        <span class="k">then</span>
          <span class="o">(</span><span class="n">swap</span> <span class="n">arr</span> <span class="o">!</span><span class="n">i</span> <span class="n">j</span><span class="o">;</span>
           <span class="n">i</span> <span class="o">:=</span> <span class="o">!</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
      <span class="k">done</span><span class="o">;</span>
      <span class="n">swap</span> <span class="n">arr</span> <span class="o">!</span><span class="n">i</span> <span class="o">(</span><span class="n">hi</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">!</span><span class="n">i</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">sort_aux</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">hi</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">then</span> <span class="bp">()</span>
    <span class="k">else</span>
      <span class="k">let</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">partition</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">hi</span> <span class="k">in</span>
      <span class="n">sort_aux</span> <span class="n">arr</span> <span class="n">lo</span> <span class="n">mid</span><span class="o">;</span>
      <span class="n">sort_aux</span> <span class="n">arr</span> <span class="n">mid</span> <span class="n">hi</span>
  <span class="k">in</span>
  <span class="n">sort_aux</span> <span class="n">arr</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span><span class="o">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>As you can notice, <code class="docutils literal notranslate"><span class="pre">Sorting</span></code> imports all definitions from <code class="docutils literal notranslate"><span class="pre">Comp</span></code>, i.e., its concrete <code class="docutils literal notranslate"><span class="pre">t</span></code> and implementation of <code class="docutils literal notranslate"><span class="pre">comp</span></code> to be provided, and uses the latter in its implementation of Quicksort.</p>
<p>Now, in order to obtain procedures for sorting particular elements (e.g., integers), we need to provide the  corresponding <em>concrete</em> modules, whose “shape” satisfies the constraints imposed by the signature <code class="docutils literal notranslate"><span class="pre">Comparable</span></code>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">IntAsc</span> <span class="o">=</span> <span class="k">struct</span>
  <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">int</span>
  <span class="k">let</span> <span class="n">comp</span> <span class="o">=</span> <span class="n">int_order_asc</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Notice that both modules above have their members named in the same
way as per the signature <code class="docutils literal notranslate"><span class="pre">Comparable</span></code>, and the type of <code class="docutils literal notranslate"><span class="pre">comp</span></code> is
both corresponds to the one in <code class="docutils literal notranslate"><span class="pre">Comparable</span></code>, module the concrete
nature of <code class="docutils literal notranslate"><span class="pre">t</span></code>, which in <code class="docutils literal notranslate"><span class="pre">IntAsc</span></code> is taken to be <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p>We can now create an instance of the sorting module by providing a
comparator module to our sorting functor:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nc">AscIntSorting</span> <span class="o">=</span> <span class="nc">Sorting</span><span class="o">(</span><span class="nc">IntAsc</span><span class="o">)</span>
</pre></div>
</div>
<p>Finally, we can export the corresponding sorting function:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">int_sort_asc</span> <span class="o">=</span> <span class="nn">AscIntSorting</span><span class="p">.</span><span class="n">sort</span>
</pre></div>
</div>
<p>and test it:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="o">%</span><span class="n">test</span> <span class="o">_</span> <span class="o">=</span> <span class="n">random_sorting_test_int</span> <span class="n">int_sort_asc</span> <span class="mi">500</span>
</pre></div>
</div>
<p>At the beginning, the machinery of modules and functors might seem
much more heavy-weight that that of simply passing comparators.
However, it will pay off to be familiar with it, once we will start
working with <em>abstract data types</em> that provide a <em>rich vocabulary</em> of
useful procedures to work with certain data, should they be given a
small corresponding module instance with <em>basic operations on that
data</em>.</p>
<p>In this sense, signatures, modules and functors in OCaml are similar
to interfaces and classes in languages such as Java and C#, but
provide somewhat more succinct way to parameterise libraries by
client-defined primitive operations. That said, OCaml features an
object model as well (similar to Java), which we won’t be using very
actively in this class.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="week-04-exercises.html" class="btn btn-neutral float-right" title="4.6. Exercises" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="week-04-divide-and-conquer-complexity.html" class="btn btn-neutral" title="4.4. Complexity of Divide-and-Conquer Algorithms" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Ilya Sergey

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"extensions": ["tex2jax.js"], "jax": ["input/TeX", "output/HTML-CSS"]})</script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>